{{ define "content" }}

<div class="p-3">
    <span id="user-profile" class="flex py-1 pr-6 pl-3 items-center bg-green-100 text-green-700 rounded-lg">
        <img id="user-image" alt="User Image" class="border border-2" style="display:none;" />
        <span id="display-name" class="text-green-700">
            Loading Profile
            <span class="user-profile-loading-dots"></span>
        </span>
    </span>

    <div id="playlists"></div>
</div>

<style>
    span#user-profile {
        max-width: fit-content;
    }
    img#user-image {
        border-radius: 100%;
        width: 2.1em;
        height: 2.1em;
        border-color: rgba(0,0,0,0.13)
    }
    span#display-name {
        margin-left: .9em;
    }
</style>

<script>
    class Api {
        static async getUserProfile() {
            const res = await fetch('/user-profile');
            if (res.status !== 200) {
                return null;
            }

            return await res.json()
        }

        static async getAllPlaylists() {
            const res = await fetch('/playlists');
            if (res.status !== 200) {
                return null;
            }

            return await res.json();
        }
    }

    class UserProfile {
        elements = {
            displayName: document.querySelector("#display-name"),
            image: document.querySelector("#user-image"),
        }

        async init() {
            new LoadingDots('.user-profile-loading-dots');

            const userProfile = await Api.getUserProfile();
            if (!userProfile) {
                return;
            }

            this.injectProfile(userProfile);
        }

        injectProfile(userProfile) {
            this.elements.displayName.innerHTML = userProfile.display_name;

            if (!userProfile.images.length) {
                this.elements.image.style.display = 'none';
                return
            }
            this.elements.image.src = userProfile.images[0].url;
            this.elements.image.style.display = 'inline-block';
        }
    }

    class Playlists {
        elements = {
            listContainer: document.querySelector('div#playlists'),
        }

        async init() {
            const playlists = await Api.getAllPlaylists();
            if (! playlists) {
                return;
            }

            this.injectPlaylists(playlists.items);
        }

        injectPlaylists(playlists) {
            for (let playlist of playlists) {
                const element = document.createElement('div');
                element.innerHTML = `<span class="playlist-item">${playlist.name}</span>`;
                this.elements.listContainer.appendChild(element);
            }
        }
    }

    class App {
        userProfile = undefined;
        playlists = undefined;

        constructor() {
            this.userProfile = new UserProfile();
            this.userProfile.init();
            this.playlists = new Playlists();
            this.playlists.init();
        }
    }

    new App();
</script>

{{ end }}
